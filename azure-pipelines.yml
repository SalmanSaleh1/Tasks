trigger:
  - master

pool:
  name: MyPool  

jobs:
  - job: Setup
    displayName: "Setup Environment"
    steps:
      - checkout: self
        displayName: "Checkout Code"

      - script: |
          echo "Installing Python 3.9..."
          choco install python --version 3.9 -y
        displayName: "Install Python"

      - script: |
          if not exist venv (
            echo "Virtual Environment not found. Creating..."
            python -m venv venv
          )
          echo "Installing Dependencies..."
          call venv\Scripts\activate && python -m pip install --no-cache-dir robotframework robotframework-seleniumlibrary robotframework-csvlibrary robotframework-pabot
        displayName: "Setup Virtual Environment & Install Dependencies"

      - script: |
          echo "Installing Chrome & ChromeDriver..."
          choco install googlechrome chromedriver -y
        displayName: "Install Chrome & ChromeDriver"

  - job: RunTests
    displayName: "Run Robot Framework Tests"
    dependsOn: Setup
    steps:
      - script: |
          echo "Checking if test directory exists..."
          if not exist test (
            echo "ERROR: Test directory not found!"
            exit /b 1
          )
        displayName: "Verify Test Directory"

      - script: |
          echo "Running Tests in Parallel..."
          call venv\Scripts\activate && python -m pabot --processes 4 --outputdir results test/
        displayName: "Run Tests with Pabot (Parallel Execution)"

      - script: |
          echo "Listing Test Results..."
          dir results
        displayName: "Debug: List Test Results"
